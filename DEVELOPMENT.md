# Development Guidelines

## ‚ö†Ô∏è CRITICAL: Leaderboard Data Files

**NEVER commit local changes to these files:**
- `public/data/leaderboard.json`
- `public/data/replay_database.json`
- `public/data/player_match_history.json`
- `docs/data/*.json`

### Why?
These files are **ONLY** updated by GitHub Actions. Local changes will ALWAYS cause merge conflicts and create inconsistencies.

### The Workflow

1. **For Local Testing Only**
   ```bash
   # Run locally to test your changes
   python3 actions/recalculate_leaderboard.py
   
   # But DO NOT commit the results!
   git checkout -- public/data/*.json docs/data/*.json
   ```

2. **For Production Updates**
   - Edit configuration files (e.g., `actions/config.py`)
   - Commit and push ONLY the config changes
   - Manually trigger the "Recalculate Full Leaderboard" workflow in GitHub Actions
   - Let Actions regenerate the data files
   - Pull the results from GitHub

### When You Get Merge Conflicts

If you accidentally have local leaderboard changes and get merge conflicts:

```bash
# Discard local changes to data files
git checkout -- public/data/*.json docs/data/*.json

# Or if already in a merge conflict:
git checkout --theirs public/data/leaderboard.json
git checkout --theirs public/data/replay_database.json
git checkout --theirs public/data/player_match_history.json
git checkout --theirs docs/data/leaderboard.json
git checkout --theirs docs/data/replay_database.json
git checkout --theirs docs/data/player_match_history.json
git add public/data/*.json docs/data/*.json
git commit -m "Resolve conflicts: accept GitHub Actions data"
```

**The GitHub Actions version is ALWAYS the source of truth.**

## Development Workflow

### Making Configuration Changes

1. Edit `actions/config.py` or other configuration files
2. Test locally (optional):
   ```bash
   python3 actions/recalculate_leaderboard.py
   # Review output but DON'T commit data files
   git checkout -- public/data/*.json docs/data/*.json
   ```
3. Commit only config changes:
   ```bash
   git add actions/config.py
   git commit -m "Update tier definitions"
   git push
   ```
4. Trigger full recalculation:
   - Go to GitHub Actions
   - Run "Recalculate Full Leaderboard" workflow
   - Wait for completion
5. Pull the updated data:
   ```bash
   git pull
   ```

### Adding New Bot Submissions

Bot submissions go through PRs automatically. The "Process New Submissions" workflow handles them incrementally.

**Never manually edit submission files or leaderboard data.**

## Two Workflows

### 1. Process New Submissions (Automatic)
- Triggered by bot PRs
- Incremental updates
- Runs hourly to catch missed updates

### 2. Recalculate Full Leaderboard (Manual Only)
- For config changes, bug fixes, algorithm updates
- Complete recalculation from scratch
- **Use this after ANY config changes**

## File Organization

### Never Commit
- `public/data/*.json` (generated by Actions)
- `docs/data/*.json` (copies for GitHub Pages)
- `.env` files
- `__pycache__/`

### Always Commit
- Configuration files (`actions/config.py`)
- Source code (`actions/*.py`, `bot/*.py`)
- Submission files (`submissions/bo3/*.json`)
- Documentation
- Workflows (`.github/workflows/*.yml`)

## Running Tests Locally

```bash
# Test bot connectivity
cd utilities && python3 test_bot.py

# Analyze submissions (read-only)
cd utilities && python3 analyze_submissions.py

# Test leaderboard calculation (but don't commit results!)
python3 actions/recalculate_leaderboard.py
git checkout -- public/data/*.json docs/data/*.json
```

## Git Best Practices

1. **Always pull before starting work**
   ```bash
   git pull
   ```

2. **Check what you're committing**
   ```bash
   git status
   git diff
   ```

3. **Never commit data files**
   ```bash
   # If accidentally staged:
   git reset public/data/*.json docs/data/*.json
   ```

4. **Keep commits focused**
   - Config changes in one commit
   - Code changes in another
   - Never mix with data file changes

## Summary

üö´ **NEVER**: Run local leaderboard updates and push the results
‚úÖ **ALWAYS**: Use GitHub Actions for all leaderboard updates
‚úÖ **ALWAYS**: Discard local data file changes before committing
‚úÖ **ALWAYS**: Accept GitHub's version in merge conflicts
